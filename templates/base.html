<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora FV On-Grid</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 20px; }
    .card { border-radius: 16px; box-shadow: 0 8px 24px rgba(0,0,0,0.06); }
    .form-text { font-size: 0.85rem; }
    .sticky-actions { position: sticky; bottom: 0; background: #fff; padding-top: 8px; }
    .invis { display: none !important; }
    .muted { color: #6c757d; }
    /* Mantener el reporte visible a la derecha al hacer scroll (desde md en adelante) */
    @media (min-width: 768px) {
      .sticky-col { position: sticky; top: 16px; }
    }
    @media print { .no-print { display:none !important; } }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="mb-2">⚡ Calculadora FV On-Grid</h1>
    <p class="text-muted mb-4">
      Vmp e Isc en <b>STC</b>; Voc ajusta con <b>β</b> (frío). Incluye exportación <b>CSV/JSON/PDF</b>,
      distribución por MPPT y <b>sugerencia de inversor</b> según <b>DC/AC</b>.
    </p>
    {% block content %}{% endblock %}
  </div>

  <script>
    // Mostrar/ocultar campo de Wh/día
    function toggleWhDay() {
      const chk = document.getElementById('use_wh_day');
      const group = document.getElementById('wh_day_group');
      if (chk && group) group.classList.toggle('invis', !chk.checked);
    }

    // Bloquear/desbloquear S cuando Auto-Serie está activo
    function toggleAutoSeries() {
      const auto = document.getElementById('auto_series');
      const sField = document.getElementById('n_series');
      const sWrap = document.getElementById('n_series_wrap');
      if (auto && sField && sWrap) {
        const disabled = auto.checked;
        sField.readOnly = disabled;
        sField.classList.toggle('bg-light', disabled);
        const hint = sWrap.querySelector('.form-text');
        if (hint) hint.textContent = disabled
          ? 'Se calculará con Vmp (STC).'
          : 'Puedes definir S manualmente.';
      }
    }

    // Compartir enlace con parámetros actuales del formulario
    function handleShare(e) {
      e.preventDefault();
      const form = document.querySelector('form#mainForm');
      const params = new URLSearchParams(new FormData(form));
      const url = `${location.origin}${location.pathname}?${params.toString()}`;
      navigator.clipboard.writeText(url).then(() => alert('Enlace copiado al portapapeles.'));
    }

    document.addEventListener('DOMContentLoaded', () => {
      toggleWhDay();
      toggleAutoSeries();
      document.getElementById('use_wh_day')?.addEventListener('change', toggleWhDay);
      document.getElementById('auto_series')?.addEventListener('change', toggleAutoSeries);
      document.getElementById('shareBtn')?.addEventListener('click', handleShare);
    });
  </script>
</body>
</html>
